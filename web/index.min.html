<!doctypehtml><html lang=en><title>RSS</title><style>*{font-family:monospace}main>*{padding:.5em}button{border:1px solid #000;border-radius:3px;cursor:pointer;opacity:60%}button:hover{opacity:100%}button.open{background-color:red;color:#fff}button.closed{background-color:green;color:#fff}summary{cursor:pointer;list-style:none}.closed{opacity:.5}details{border-bottom:1px solid #000}label{cursor:pointer}</style><body x-data><main><div><span x-show=$store.issues.loading>⏳ Loading</span><span x-show=!$store.issues.loading>✅ <span x-text="$store.issues.list.length + ' issues'"></span></span> <label for=open x-effect=$store.issues.fetch()><input id=open type=checkbox x-model=$store.issues.filter.open> open</label> <span x-text=JSON.stringify($store.issues.filter)></span></div><template x-for="issue in $store.issues.list"><details :class="{closed: issue.state === 'closed'}"><summary><div><button @click.prevent=$store.issues.toggle_open(issue) x-text="issue.state == 'open' ? '−' : '+'":class=issue.state></button> <template x-for="label in issue.labels"><button @click.prevent=$store.issues.filter_by_label(label.name) x-text=label.name></button></template></div><strong x-text=issue.title></strong></summary><div x-html=issue.body></div></details></template></main><script type=module>const token="XXX",repository="XXX";import{Octokit,App}from"https://cdn.skypack.dev/octokit";import Alpine from"https://cdn.skypack.dev/alpinejs";const{rest:rest,paginate:paginate}=new Octokit({auth:"XXX"}),[owner,repo]="XXX".split("/");window.Alpine=Alpine,document.addEventListener("keyup",(function(e){switch(e.code){case"KeyJ":Alpine.store("issues").move(1);break;case"KeyK":Alpine.store("issues").move(-1);break;case"KeyC":Alpine.store("issues").toggle_open()}})),Alpine.store("issues",{loading:!0,filter:{open:!0},list:[],index:-1,init(){this.fetch()},open(){console.log(this.list[this.index])},move(e){this.index+=e,document.querySelectorAll("details").forEach(((e,t)=>{t===this.index?(e.setAttribute("open",!0),e.scrollIntoView()):e.removeAttribute("open")}))},fetch(){this.loading=!0,paginate(rest.issues.listForRepo,{owner:owner,repo:repo,state:this.filter.open?"open":"closed"}).then((e=>this.list=e.filter((e=>e.body&&0!=e.body.length&&void 0===e.pull_request)))).catch(alert).finally((()=>this.loading=!1))},filter_by_label(e){console.log(`TODO, filter by label ${e}`)},toggle_open(e){(e=e||this.list[this.index]).state="open"===e.state?"closed":"open",rest.issues.update({owner:owner,repo:repo,issue_number:e.number,state:e.state}).then(console.log).catch(alert)}}),Alpine.start()</script>